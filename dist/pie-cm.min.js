!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof module&&module.exports?module.exports=e():t.PieContextMenu=e()}(this,function(){"use strict";var t="http://www.w3.org/2000/svg",e=function(t){this.menuablesClass=t.menuItemClass,this.numberOfButton=0,this.menu,this.menu_id=t.menuID,this.menuPosition,this.menu_svg,this.menu_svg_id=this.menu_id+"_svg",this.center,this.menuState=0,this.active="pie-context-menu--active",this.menuSize=t.menuSize,this.menuActivateEvent=t.menuActivateEvent||"contextmenu",this.radius,this.stroke_width,this.font_size,this.lastSelectedElement=null,this.buttons=[],this.init()};return e.Button=function(t,e,n){this.index=t,this.text=e,this.icon=n,this.isNew=!0,this.element},e.prototype.init=function(){this.menu=document.createElement("nav"),this.menu_svg=document.createElementNS(t,"svg"),this.menu.appendChild(this.menu_svg),this.center=document.createElementNS(t,"circle"),this.menu_svg.appendChild(this.center),this.reset(),this.create(),this.menuActivateListener(this.menuActivateEvent),this.leftClickListener(),this.keyupListener()},e.prototype.create=function(){var t=document.getElementById(this.menu_id);null===t&&document.body.appendChild(this.menu)},e.prototype.destroy=function(){var t=document.getElementById(this.menu_id);null!=t&&document.body.removeChild(this.menu)},e.prototype.reset=function(){this.closeMenu(),this.radius=this.menuSize/3,this.stroke_width=this.menuSize/5,this.font_size=Math.round(this.menuSize/12),this.menu.setAttribute("id",this.menu_id),this.menu.setAttribute("class","pie-context-menu"),this.menu.setAttribute("width",this.menuSize),this.menu.setAttribute("height",this.menuSize),this.menu_svg.setAttribute("id",this.menu_svg_id),this.menu_svg.setAttribute("width",this.menuSize),this.menu_svg.setAttribute("height",this.menuSize),this.draw()},e.prototype.menuActivateListener=function(t){var e=this;document.addEventListener(t,function(t){var n=e.containsClass(t,e.menuablesClass);n?(t.preventDefault(),e.lastSelectedElement=n,e.openMenu(),e.positionMenu(t)):e.closeMenu()})},e.prototype.leftClickListener=function(){var t=this;document.addEventListener("click",function(e){var n=e.which||e.button;1===n&&t.closeMenu()})},e.prototype.keyupListener=function(){var t=this;document.addEventListener("keydown",function(e){var n=e.keyCode;27===n&&t.closeMenu()},!1)},e.prototype.closeMenu=function(){0!==this.menuState&&(this.menuState=0,this.menu.classList.remove(this.active))},e.prototype.openMenu=function(){1!==this.menuState&&(this.menuState=1,this.menu.classList.add(this.active))},e.prototype.positionMenu=function(t){this.menuPosition=this.getPosition(t);var e=this.menu.offsetWidth,n=this.menu.offsetHeight,i=window.innerWidth,s=window.innerHeight,o=this.menuPosition.x-e/2,u=this.menuPosition.y-n/2;this.menuPosition.x<e/2?o=0:this.menuPosition.x>i-e/2&&(o-=e/2),this.menuPosition.y<n/2?u=0:this.menuPosition.y>s-n/2&&(u-=n/2),this.menu.style.left=o+"px",this.menu.style.top=u+"px"},e.prototype.containsClass=function(t,e){var n=t.srcElement||t.target;if(n.classList.contains(e))return n;for(;n=n.parentNode;)if(n.classList&&n.classList.contains(e))return n;return!1},e.prototype.getPosition=function(t){var e=0,n=0;if(!t)var t=window.event;return t.pageX||t.pageY?(e=t.pageX,n=t.pageY):(t.clientX||t.clientY)&&(e=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:e,y:n}},e.prototype.draw=function(){e.setCenterCircle(this.center,this.radius,this.menuSize);for(var t=0;t<this.numberOfButton;t++)this.createMenuButton(this.buttons[t])},e.prototype.createMenuButton=function(n){var i,s,o,u,r,c=n.index,h=n.text,m=n.icon,d=this.radius,a=this.stroke_width,l=this.font_size,p=this.numberOfButton;this.buttons[c].isNew?(i=document.createElementNS(t,"g"),s=document.createElementNS(t,"circle"),o=document.createElementNS(t,"text"),u=document.createElementNS(t,"text"),r=this.menu_id+"_button_"+(c+1),i.appendChild(s),i.appendChild(o),i.appendChild(u),this.menu_svg.appendChild(i),n.element=i,this.buttons[c].isNew=!1):(i=this.buttons[c].element,s=this.buttons[c].element.childNodes[0],o=this.buttons[c].element.childNodes[1],u=this.buttons[c].element.childNodes[2],r=this.buttons[c].element.id),e.setMenuButtonG(i,r,this.menuSize),e.setMenuButton(s,d,a,c,p),e.setMenuTitle(o,h,l),e.setMenuIcon(u,m,d,c,p,l)},e.prototype.resize=function(t){this.menuSize=t,this.reset()},e.prototype.addButton=function(t,n){this.buttons[this.numberOfButton]=new e.Button(this.numberOfButton,t,n),this.numberOfButton++,this.reset()},e.Button.prototype.changeText=function(t){this.text=t,this.element.childNodes[1].textContent=this.text},e.Button.prototype.changeIcon=function(t){this.icon=t,this.element.childNodes[2].textContent=t},e.setMenuButtonG=function(t,n,i){return t.setAttribute("id",n),t.setAttribute("class","pcm_group"),t.setAttribute("transform","translate("+i/2+","+i/2+")"),t.addEventListener("mouseover",function(t){e.menu_button_mouseover(this)}),t.addEventListener("mouseout",function(t){e.menu_button_mouseout(this)}),t},e.setMenuButton=function(t,e,n,i,s){t.setAttribute("class","pcm_button"),t.setAttribute("r",e),t.setAttribute("stroke-width",n);var o=2*Math.PI*e,u=o/s+o/500,r=-180+360/s*i;return t.setAttribute("stroke-dasharray",u+" "+o),t.setAttribute("transform","rotate("+r+",0,0)"),t},e.setMenuTitle=function(t,e,n){return t.textContent=e,t.setAttribute("class","pcm_title"),t.setAttribute("y","0.35em"),t.setAttribute("font-size",n),t.setAttribute("display","none"),t},e.setMenuIcon=function(t,n,i,s,o,u){var r=-180+360/o*s,c=-1*(r+180/o),h=e.polarToCartesian(i,c);return t.textContent=n,t.setAttribute("class","pcm_icon"),t.setAttribute("x",h.x),t.setAttribute("y",-h.y),t.setAttribute("dy","0.35em"),t.setAttribute("font-size",u),t},e.setCenterCircle=function(t,e,n){t.setAttribute("class","pcm_center"),t.setAttribute("r",e),t.setAttribute("transform","translate("+n/2+","+n/2+")")},e.polarToCartesian=function(t,e){var n=e*(Math.PI/180),i={x:t*Math.cos(n),y:t*Math.sin(n)};return i},e.faviconClassToText=function(t){var e=document.createElement("i");e.className=t,document.body.appendChild(e);var n=getComputedStyle(e,":before"),i=n.content;return i=i.substr(1),i=i.substr(0,i.length-1),document.body.removeChild(e),i},e.menu_button_mouseover=function(t){t.childNodes[0].classList.add("pcm_button--hover"),t.childNodes[1].setAttribute("display","inline"),t.childNodes[2].classList.add("pcm_icon--hover")},e.menu_button_mouseout=function(t){t.childNodes[0].classList.remove("pcm_button--hover"),t.childNodes[1].setAttribute("display","none"),t.childNodes[2].classList.remove("pcm_icon--hover")},e});