"use strict";var SVG_NS="http://www.w3.org/2000/svg",PieContextMenu=function(t){this.menuablesClass=t.menuItemClass,this.numberOfButton=0,this.menu,this.menu_id=t.menuID,this.menuPosition,this.menu_svg,this.menu_svg_id=this.menu_id+"_svg",this.center,this.menuState=0,this.active="pie-context-menu--active",this.menuSize=t.menuSize,this.menuActivateEvent=t.menuActivateEvent||"contextmenu",this.radius,this.stroke_width,this.font_size,this.lastSelectedElement=null,this.buttons=[],this.init()};PieContextMenu.Button=function(t,e,n){this.index=t,this.text=e,this.icon=n,this.isNew=!0,this.element},PieContextMenu.prototype.init=function(){this.menu=document.createElement("nav"),this.menu_svg=document.createElementNS(SVG_NS,"svg"),this.menu.appendChild(this.menu_svg),this.center=document.createElementNS(SVG_NS,"circle"),this.menu_svg.appendChild(this.center),this.reset(),this.create(),this.menuActivateListener(this.menuActivateEvent),this.leftClickListener(),this.keyupListener()},PieContextMenu.prototype.create=function(){var t=document.getElementById(this.menu_id);null===t&&document.body.appendChild(this.menu)},PieContextMenu.prototype.destroy=function(){var t=document.getElementById(this.menu_id);null!=t&&document.body.removeChild(this.menu)},PieContextMenu.prototype.reset=function(){this.closeMenu(),this.radius=this.menuSize/3,this.stroke_width=this.menuSize/5,this.font_size=Math.round(this.menuSize/12),this.menu.setAttribute("id",this.menu_id),this.menu.setAttribute("class","pie-context-menu"),this.menu.setAttribute("width",this.menuSize),this.menu.setAttribute("height",this.menuSize),this.menu_svg.setAttribute("id",this.menu_svg_id),this.menu_svg.setAttribute("width",this.menuSize),this.menu_svg.setAttribute("height",this.menuSize),this.draw()},PieContextMenu.prototype.menuActivateListener=function(t){var e=this;document.addEventListener(t,function(t){var n=e.containsClass(t,e.menuablesClass);n?(t.preventDefault(),e.lastSelectedElement=n,e.openMenu(),e.positionMenu(t)):e.closeMenu()})},PieContextMenu.prototype.leftClickListener=function(){var t=this;document.addEventListener("click",function(e){var n=e.which||e.button;1===n&&t.closeMenu()})},PieContextMenu.prototype.keyupListener=function(){var t=this;document.addEventListener("keydown",function(e){var n=e.keyCode;27==n&&t.closeMenu()},!1)},PieContextMenu.prototype.closeMenu=function(){0!==this.menuState&&(this.menuState=0,this.menu.classList.remove(this.active))},PieContextMenu.prototype.openMenu=function(){1!==this.menuState&&(this.menuState=1,this.menu.classList.add(this.active))},PieContextMenu.prototype.positionMenu=function(t){this.menuPosition=this.getPosition(t);var e=this.menu.offsetWidth,n=this.menu.offsetHeight,i=window.innerWidth,s=window.innerHeight,o=this.menuPosition.x-e/2,u=this.menuPosition.y-n/2;this.menuPosition.x<e/2?o=0:this.menuPosition.x>i-e/2&&(o-=e/2),this.menuPosition.y<n/2?u=0:this.menuPosition.y>s-n/2&&(u-=n/2),this.menu.style.left=o+"px",this.menu.style.top=u+"px"},PieContextMenu.prototype.containsClass=function(t,e){var n=t.srcElement||t.target;if(n.classList.contains(e))return n;for(;n=n.parentNode;)if(n.classList&&n.classList.contains(e))return n;return!1},PieContextMenu.prototype.getPosition=function(t){var e=0,n=0;if(!t)var t=window.event;return t.pageX||t.pageY?(e=t.pageX,n=t.pageY):(t.clientX||t.clientY)&&(e=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:e,y:n}},PieContextMenu.prototype.draw=function(){PieContextMenu.setCenterCircle(this.center,this.radius,this.menuSize);for(var t=0;t<this.numberOfButton;t++)this.createMenuButton(this.buttons[t])},PieContextMenu.prototype.createMenuButton=function(t){var e,n,i,s,o,u=t.index,r=t.text,h=t.icon,c=this.radius,m=this.stroke_width,a=this.font_size,d=this.numberOfButton;if(this.buttons[u].isNew){var e=document.createElementNS(SVG_NS,"g"),n=document.createElementNS(SVG_NS,"circle"),i=document.createElementNS(SVG_NS,"text"),s=document.createElementNS(SVG_NS,"text"),o=this.menu_id+"_button_"+(u+1);e.appendChild(n),e.appendChild(i),e.appendChild(s),this.menu_svg.appendChild(e),t.element=e,this.buttons[u].isNew=!1}else var e=this.buttons[u].element,n=this.buttons[u].element.childNodes[0],i=this.buttons[u].element.childNodes[1],s=this.buttons[u].element.childNodes[2],o=this.buttons[u].element.id;PieContextMenu.setMenuButtonG(e,o,this.menuSize),PieContextMenu.setMenuButton(n,c,m,u,d),PieContextMenu.setMenuTitle(i,r,a),PieContextMenu.setMenuIcon(s,h,c,u,d,a)},PieContextMenu.prototype.resize=function(t){this.menuSize=t,this.reset()},PieContextMenu.prototype.addButton=function(t,e){this.buttons[this.numberOfButton]=new PieContextMenu.Button(this.numberOfButton,t,e),this.numberOfButton++,this.reset()},PieContextMenu.Button.prototype.changeText=function(t){this.text=t,this.element.childNodes[1].textContent=this.text},PieContextMenu.Button.prototype.changeIcon=function(t){this.icon=t,this.element.childNodes[2].textContent=t},PieContextMenu.setMenuButtonG=function(t,e,n){return t.setAttribute("id",e),t.setAttribute("class","pcm_group"),t.setAttribute("transform","translate("+n/2+","+n/2+")"),t.setAttribute("onmouseover","PieContextMenu.menu_button_mouseover(this)"),t.setAttribute("onmouseout","PieContextMenu.menu_button_mouseout(this)"),t},PieContextMenu.setMenuButton=function(t,e,n,i,s){t.setAttribute("class","pcm_button"),t.setAttribute("r",e),t.setAttribute("stroke-width",n);var o=2*Math.PI*e,u=o/s+o/500,r=-180+360/s*i;return t.setAttribute("stroke-dasharray",u+" "+o),t.setAttribute("transform","rotate("+r+",0,0)"),t},PieContextMenu.setMenuTitle=function(t,e,n){return t.textContent=e,t.setAttribute("class","pcm_title"),t.setAttribute("y","0.35em"),t.setAttribute("font-size",n),t.setAttribute("display","none"),t},PieContextMenu.setMenuIcon=function(t,e,n,i,s,o){var u=-180+360/s*i,r=-1*(u+180/s),h=PieContextMenu.polarToCartesian(n,r);return t.textContent=e,t.setAttribute("class","pcm_icon"),t.setAttribute("x",h.x),t.setAttribute("y",-h.y),t.setAttribute("dy","0.35em"),t.setAttribute("font-size",o),t},PieContextMenu.setCenterCircle=function(t,e,n){t.setAttribute("class","pcm_center"),t.setAttribute("r",e),t.setAttribute("transform","translate("+n/2+","+n/2+")")},PieContextMenu.polarToCartesian=function(t,e){var n=e*(Math.PI/180),i={x:t*Math.cos(n),y:t*Math.sin(n)};return i},PieContextMenu.faviconClassToText=function(t){var e=document.createElement("i");e.className=t,document.body.appendChild(e);var n=getComputedStyle(e,":before"),i=n.content;return i=i.substr(1),i=i.substr(0,i.length-1),document.body.removeChild(e),i},PieContextMenu.menu_button_mouseover=function(t){t.childNodes[0].classList.add("pcm_button--hover"),t.childNodes[1].setAttribute("display","inline"),t.childNodes[2].classList.add("pcm_icon--hover")},PieContextMenu.menu_button_mouseout=function(t){t.childNodes[0].classList.remove("pcm_button--hover"),t.childNodes[1].setAttribute("display","none"),t.childNodes[2].classList.remove("pcm_icon--hover")};